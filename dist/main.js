!function(){"use strict";var e=JSON.parse('{"id":"acode.plugin.lint"}');function t(e,t){var r=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}(e,t);return function(e,t){return t.get?t.get.call(e):t.value}(e,r)}const{WorkerClient:r}=ace.require("ace/worker/worker_client"),n=ace.require("ace/lib/net"),o=ace.require("ace/config"),i=acode.require("settings");var s=new WeakMap;class a{constructor(){var e,t,r;r={get:c,set:void 0},function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e=this,t=s),t.set(e,r),function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"baseUrl",""),this.startWorker=this.startWorker.bind(this)}async init(){const{editor:e}=editorManager;e.renderer.setMargin(0,0,0,0),e.on("changeMode",this.startWorker),this.startWorker(),t(this,s).forEach((t=>{e.commands.addCommand(t)}))}async destroy(){const{editor:e}=editorManager;t(this,s).forEach((t=>{e.commands.removeCommand(t)})),e.off("changeMode",this.startWorker)}async startWorker(){try{const{editor:e}=editorManager,{session:t}=e;await this.initWorker(t,t.$mode)}catch(e){console.error(e)}}async initWorker(e,t){if("string"==typeof t&&(t=o.$modes[t]),!t)return;const r=t.$id.split("/").pop();await this.createWorker(r,e,t)}async createWorker(e,t,n){try{t.$worker&&(t.$worker.terminate(),t.$worker=null);const o="workers/worker-".concat(e,".js"),i="ace/mode/".concat(e,"_worker"),s=acode.joinUrl(this.baseUrl,o),c=a.getWorkerClass(e),l=new r(["ace"],i,c,s);return l.attachToDocument(t.getDocument()),t.$worker=l,"xquery"===e?(l.on("ok",(function(e){t.clearAnnotations()})),l.on("markers",(function(e){t.clearAnnotations(),n.addMarkers(e.data,t)})),void l.on("highlight",(function(e){n.$tokenizer.tokens=e.data.tokens,n.$tokenizer.lines=t.getDocument().getAllLines();const r=Object.keys(n.$tokenizer.tokens);for(let e=0;e<r.length;e++){const n=parseInt(r[e]);delete t.bgTokenizer.lines[n],delete t.bgTokenizer.states[n],t.bgTokenizer.fireUpdateEvent(n,n)}}))):"html"===e||"xml"===e?(n.fragmentContext&&l.call("setOptions",[{context:this.fragmentContext}]),l.on("error",(function(e){t.setAnnotations(e.data)})),void l.on("terminate",(function(){t.clearAnnotations()}))):(n.inlinePhp&&l.call("setOptions",[{inline:!0}]),"javascript"===e&&(this.esversion=this.settings.esversion),l.on("annotate",(e=>{t.setAnnotations(e.data)})),l.on("terminate",(()=>{t.clearAnnotations()})),l)}catch(e){return console.log(e),null}}async loadScript(e){const t=e.hashCode();if(document.getElementById(t))return;const r=document.createElement("script");return r.src=e,r.id=t,document.head.appendChild(r),new Promise(((e,t)=>{r.onload=e,r.onerror=t}))}get settings(){return i.value[e.id]||(i.value[e.id]={esversion:11},i.update(!1)),i.value[e.id]}get settingsList(){return[{key:"esversion",text:"JShint esversion",value:this.settings.esversion,prompt:"Enter esversion",promptType:"number"}]}settingsCallback(e,t){"esversion"===e&&(this.esversion=t||11,this.settings.esversion=t,i.update())}get esversion(){var e;return(null===(e=this.settings)||void 0===e?void 0:e.esversion)||8}set esversion(e){var t;const r=null===(t=editorManager.session)||void 0===t?void 0:t.$worker;r&&r.call("setOptions",[{esversion:e}])}static workerBlob(e){const t="importScripts('"+n.qualifyURL(e)+"');";try{return new Blob([t],{type:"application/javascript"})}catch(e){const r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder);return r.append(t),r.getBlob("application/javascript")}}static getWorkerClass(e){switch(e){case"javascript":return"JavaScriptWorker";case"json":return"JsonWorker";case"xquery":return"XQueryWorker";case"php":return"PhpWorker";case"yaml":return"YamlWorker";default:return"Worker"}}}function c(){return[{name:"setJshintEsversion",description:"Set JShint esversion.",exec:async()=>{const e=this.settings.esversion,t=await acode.prompt("Enter esversion",e,"number",{required:!0});this.settings.esversion=t,i.update(),this.esversion=t}}]}if(window.acode){const t=new a;acode.setPluginInit(e.id,((e,r,n)=>{let{cacheFileUrl:o,cacheFile:i}=n;e.endsWith("/")||(e+="/"),t.baseUrl=e,t.init(r,i,o)}),{list:t.settingsList,cb:t.settingsCallback.bind(t)}),acode.setPluginUnmount(e.id,(()=>{t.destroy()}))}}();